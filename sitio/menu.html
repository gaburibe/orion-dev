<!DOCTYPE html>
<html>
<head>
	  <meta charset="UTF-8">

	<link rel="stylesheet" href="css/bootstrap.min.css">
	<script type="text/javascript" src="js/jquery.js" />
	<script type="text/javascript" src="js/bootstrap.js" />
	<link href="css/addons/datatables.min.css" rel="stylesheet">
	
	<!-- MDBootstrap Datatables  -->
<script type="text/javascript" src="js/addons/datatables.min.js"></script>

	<title>〔 〄 〕 - Orion</title>
</head>
<style type="text/css">
	table.dataTable thead .sorting:after,
table.dataTable thead .sorting:before,
table.dataTable thead .sorting_asc:after,
table.dataTable thead .sorting_asc:before,
table.dataTable thead .sorting_asc_disabled:after,
table.dataTable thead .sorting_asc_disabled:before,
table.dataTable thead .sorting_desc:after,
table.dataTable thead .sorting_desc:before,
table.dataTable thead .sorting_desc_disabled:after,
table.dataTable thead .sorting_desc_disabled:before {
  bottom: .5em;
}
body{
	/*background: url("img/onigiri.gif");*/
	/*background-size: cover;*/
	/*background: url(http://thegardenreview.net/doc/intermedio/schematics-1.gif);
*/
}
.head{
	text-align: center;
	font-family: monospace;
	background-color: #fafafa7d;
}
.products{
	background-color: whitesmoke;
}
.searcharea{
	color: white;
    background-color: seagreen;
}
.logo{
	width:150px;
}
.prInput{
	width:100px;
}
.carrito{
	font-size: 15pt;
    width: 100%;

    text-align: center;
    background-color: slategrey;
    color: white;
    border-radius: 25px;
  border: 2px solid dimgrey;
  padding: 20px;
  cursor: pointer;
  box-shadow: 3px 3px #5049a9;
  
}
.carrito:hover{
	background-color: white;
}
.carrito2{
	font-size: 15pt;
    width: 100%;
    text-align: center;
    background-color: grey;
        /*box-shadow: 3px 3px #00000047;*/
    color: black;
    border-radius: 25px;
  border: 2px solid dimgrey;
  padding: 20px;
  /*box-shadow: 3px 3px #5049a9;*/
  
}
.rabi{
    /* border-radius: 15px; */
    border: 2px solid dimgrey;
    padding: 20px;
    box-shadow: 3px 3px #00000047;
}
.ordenar{
	font-size: 15pt;
    width: 100%;
    padding-left: 10%;
    text-align: center;
        background-color: #49a954;
    color: white;
    border-radius: 25px;
  border: 2px solid dimgrey;
  padding: 20px;
  cursor: pointer;
  box-shadow: 3px 3px #5049a9;
  
}
.ordenar:hover{
	background-color: white;
	color:black;
}

.regresar{
	font-size: 15pt;
    width: 100%;
    padding-left: 10%;
    text-align: center;
        background-color: slategrey;
    color: white;
    border-radius: 25px;
  border: 2px solid dimgrey;
  padding: 20px;
  cursor: pointer;
  box-shadow: 3px 3px #5049a9;
  
}
.regresar:hover{
	background-color: white;
	color:black;
}
.total_title{
	font-size: 26pt;
    width: 80%;
    padding-left: 10%;
    text-align: center;
    background-color: #49a954;
    color: white;
}
.total{
	font-size: 26pt;
    width: 100%;
    text-align: center;
    background-color: #fafafa;
    color: #49a954;
}
.compras{
	background-color: lightgrey;

}
.hide{

}
.totalind{
	font-family: monospace;
	color: black;
	font-size: 16pt;
}
.button-p {
    margin: 0 0 0 5px;
    text-indent: -9999px;
    cursor: pointer;
    width: 35px;
    height: 35px;
    float: left;
    text-align: center;
    background: url(img/plus.png) no-repeat;
    background-size: cover;
}
.button-m {
    margin: 0 0 0 5px;
    text-indent: -9999px;
    cursor: pointer;
    width: 35px;
    height: 35px;
    float: left;
    text-align: center;
    background: url(img/minus.png) no-repeat;
    background-size: cover;
}
.inputsmall{
	float: left;
    width: 60px;
    font: 700 20px Helvetica,sans-serif;
    padding: 3px 0 0;
}
.mapa{
	 border-radius: 25px;
  border: 2px solid dimgrey;
  padding: 20px;
  cursor: pointer;
  box-shadow: 3px 3px #5049a9;
  background-color: white;
  color:black;
}
.splash{
	display: none;
	background-color: white;
	width:100%;
	padding:20px;
	/*height:400px;*/
}


</style>
<link rel="stylesheet" href="css/orion.css">
<body>
	<div class="glass"></div>
	<br>
<div class="container head" >
	<div class="row">
		<div class="col-sm-6" >
			
			<h1 ></h1>
			<br>
			<h5 style="color:black;"> Orion</h5>
			<h5 style="color:black;"> Contacto por Whatsapp: 5536499279</h5>
			<br>
			<!-- <input type="button" value="¿Cómo funciona?" name=""/> -->
		</div>
		<div class="col-sm-6">
			<img src="img/logo.png" class="logo">
			<hr>
			<audio controls>
  <source src="clair-de-lune.mp3" type="audio/mpeg">
Your browser does not support the audio element.
</audio><br>
Claro de luna - Kamasi Washington
<hr>
			<span style="color:black;">Servidor de prueba
<br>
<!-- <img src="img/onigiri.gif" style="width:150px;">
 -->	</span>
		</div>
	</div>


	<hr/>
</div>


<div class="container searcharea" >
		<div class="row">
		<div class="col-sm-12" id="infousuario" style="display:none;">
				

          	
          <div class="col-sm-6" id="t_id" style="display:none;">id</div>
          <div class="row">
          	<div class="col-sm-4" >
          		<span style="color:black;">Usuario:</span>
          		<span id="t_username"></span>
          	</div>
          	<div class="col-sm-4" id="">
          		<span style="color:black;">Crédito:</span>
          		<span id="t_credit"></span>
          	</div>
          	<div class="col-sm-4" id="">
          		<span style="color:black;">Nombre:</span>
          		<span id="t_name"></span>
          	</div>
          </div>
          <div class="row">
          	<div class="col-sm-4" id="">
          		<span style="color:black;">Email:</span>
          		<span id="t_email"></span>
          	</div>
          	<div class="col-sm-4" id="">
          		<span style="color:black;">Teléfono:</span>
          		<span id="t_phone"></span>
          	</div>
          	<div class="col-sm-4" id="">
          		<span style="color:black;">CP:</span>
          		<span id="t_cp"></span>
          	</div>
          </div>
          <div class="row">
          	<div class="col-sm-2" id="">
          		<span style="color:black;">Calle:</span>
          		<span id="t_calle"></span>
          	</div>
          	<div class="col-sm-2" id="">
          		<span style="color:black;">No exterior:</span>
          		<span id="t_noext"></span>
          	</div>
          	<div class="col-sm-2" id="">
          		<span style="color:black;">No interior:</span>
          		<span id="t_noint"></span>
          	</div>
          	<div class="col-sm-3" id="">
          		<span style="color:black;">Colonia:</span>
          		<span id="t_colonia"></span>
          	</div>
          	<div class="col-sm-3" id="">
          		<span style="color:black;">Delegación:</span>
          		<span id="t_delegacion"></span>
          	</div>
          </div>
          <div class="row">
          	<div class="col-sm-4" id="">
          		<span style="color:black;"></span>
          		<span id="console"></span>
          	</div>
          	<div class="col-sm-4" id="">
          		<span style="color:black;">Zona:</span>
          		<span id="zonaenv"></span>
          	</div>
          	<div class="col-sm-4" id="">
          		<span style="color:black;">Costo de envio:</span>
          		<span id="costoenv"></span>
          	</div>
          	
          </div>
          
          
          
          
          
          
          
          
          

			</div>
		<!-- <div class="col-sm-4" id="search1">
			<p class="instrucciones">1-Añade productos a tu orden mediante el menú</p>
		div.col-sm-4	
		</div> -->
		<div class="col-sm-4 noback" id="search2">
			<!-- <p class="instrucciones">Completa la información de tu pedido:</p> -->
			<br>
			<form id="loginform">
            <div class="input-group mb-3 noback">
              <div class="input-group-append">
                <span class="input-group-text"><i class="fas fa-user"></i></span>
              </div>
              <input type="text" id="_u" class="form-control input_user" value="" placeholder="usuario">
            </div>
            <div class="input-group mb-2 noback">
              <div class="input-group-append">
                <span class="input-group-text"><i class="fas fa-key"></i></span>
              </div>
              <input type="password" id="_p" class="form-control input_pass" value="" placeholder="password">
            </div>
           <!--  <div class="form-group">
              <div class="custom-control custom-checkbox">
                <input type="checkbox" class="custom-control-input" id="customControlInline">
                <label class="custom-control-label" for="customControlInline">Remember me</label>
              </div>
            </div> -->
              <div class="d-flex justify-content-center mt-3 login_container noback divlast">
          <button type="button" name="button" onclick="dosignin()" class="btn login_btn">Login</button>
          <!-- <button type="button" name="button" onclick="checkInfo()" class="btn login_btn">info</button> -->
          
           </div>
          </form>
          <table id="userinfo" class="table">
          	
          </table>
		</div>
		<div class="col-sm-4 noback" id="search3">
			<div id="nuevoreg" class="noback">
				<p class="instrucciones">Si esta es tu primera visita registra tus datos en el siguiente link:</p>
			
				<div class="row noback">
				<div class="d-flex justify-content-center links noback">
		        <div class="row noback">
					<a class="mapa" style="font-size:15pt;" href="/registro" target="_blank">Registro
						<br>
						<!-- <img src="img/mapa.png" style="height: 50%;"> -->
					</a>
				</div>
				</div>
				</div>
			</div>
			
		</div>
		
	</div>

		
</div>	


<div class="container controllers" >
<div class="row">
	<div class="col-sm-6">
		<div class="row noback">
				
					<div class="carrito2 "><p style="font-size: 13pt;color:black;">total:</p><span id="sum">0</span> Pesos </div>
				
				
			</div>
	</div>
	<div class="col-sm-6">
		<div class="row noback">
					<button class="checkout " onclick="checkout();">checkout</button>
			</div>
	</div>
</div>
</div>


<div class="container splash" >



	<div class="regresar" onclick="regresar();">regresar al menú</div>
	<br>
	<h3>Información de contacto:</h3>
<h4 style="color:black;" id="confirmainfo"></h4>
<h4>TOTAL:</h4>
<h4 style="color:black;" id="confirmatotal"></h4>
	
	<hr>
	<p>Si quieres revisar nuevamente tu pedido, puedes utilizar el botón de “regresa al menú” y usar el botón de vizualisar pedido. </p>
	<hr>

	<h4>Siguientes pasos:</h4>
	<ul>
		<li>1.    COMPLETA TU ORDEN DANDO CLICK EN EL BOTON VERDE DE ABAJO: Si no lo haces, tus productos no serán apartados y puedes quedarte sin ellos</li>
		<li>2.    REALIZA TU PAGO: contamos con dos métodos:<br>
- xxxxx <br>
- Por transferencia: CLABE: xxxxx</li>
		<li> 3.    ENVÍA TU COMPROBANTE DE PAGO Y # DE ORDEN A NUESTRO WHATSAPP xxxx

</li>
	</ul>
	
<h5>Los envíos se entregan el día jueves de cada semana. En caso de recolección en Ámsterdam 46, el pedido estará listo a partir de las 16:00 hrs.</h5>
    
<hr>
   


<div id="avisofinal"></div>
<h1 id="numorden"></h1>
<br>
<hr>
<div class="ordenar" onclick="ordenar();">COMPLETAR ORDEN</div>
</div>

<div class="container" id="table_cont" >
<div class="row" style="background-color: white;">
	<div class="col-sm-6" >
		Buscar por palabra:<br>
		<input type="text" id="myinput" style="width:100%;" class="rabi"/><br>
	</div>   
	<div class="col-sm-6" >
		Visualizar solo compras:<br>
			<div class="carrito" onclick="togglecar()"><img src="img/carrito.png" style="width:50px;"></div>
	</div>
	
		
			
		


</div>
<div class="row">
	<table id="myTable" class="table products" cellspacing="0" width="100%"> <!-- table-striped table-bordered table-sm -->
	  	<thead>
	    <tr>
	      
	      <th class="th-sm">Productor
	      </th>
	      <th class="th-sm">producto
	      </th>
	      <th class="th-sm">existencia
	      </th>
	      <th class="th-sm">unidad
	      </th>
	      <th class="th-sm">precio
	      </th>
	      <th class="th-sm">ordenar
	      </th>
	      <th class="th-sm">total por producto
	      </th>
	     
	    </tr>
	  	</thead>
	  	<tbody id="tabla_productos">
	    	<!-- <tr>
		      
		      <td>Cerveza lagger</td>
		      <td>Mounstro de Agua</td>
		      <td>$61</td>
		      <td>input</td>
		      <td>preciotot</td>
		    </tr> -->
		    
		  </tbody>
		  <tfoot>
		    
		  </tfoot>
	</table>
</div> <!-- ROW -->
</div> <!-- table_container -->
</body>
<script type="text/javascript">
_MENU={};
_productos={};
carselected=false;
_USER={};
_ZONA="";
$(document).ready(function(){
	makesum();
	getMenu();
	jwt=getCookie("jwt");

	  if(jwt.length>=2){
	    checkInfo();
	  }

	  $("#myinput").on("keyup", function() {
	    var value = $(this).val().toLowerCase();
	    $("#myTable tr").filter(function() {
	      $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
	    });
	  });
	  $('input:radio[name=zona]').on("click", function() {
	    makesum();
	  });

});
function checkcp(cp){
  
	console.log("checking",cp)
    $.ajax({
        url: '/checkcp',
        type: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({"cp":cp}),
        dataType: 'json',
        error: function(xhr, status, error) {
          console.log(xhr, status, error);
          $("#console").html("Por el momento no tenemos cobertura en tu zona.");
          //alert(xhr.responseText);
        },
        success: function (data){
          console.log(data)
          $("#console").html("");
          _ZONA=data[1];
          $("#zonaenv").html(data[1]);
          $("#costoenv").html(data[2]);
          makesum();
          // $(".step1").addClass('d-none');
          // $(".step2").removeClass('d-none');
          
        }
    });

}
function getMenu(){

	var xmlhttp = new XMLHttpRequest();
	xmlhttp.onreadystatechange = function() {
  		if (this.readyState == 4 && this.status == 200) {
	    var myObj = JSON.parse(this.responseText);
	    _MENU=myObj;
	    console.log(_MENU)
	    despliegaMenu();
	    
	  	}
	};
	xmlhttp.open("GET", "/menu", true);
	xmlhttp.send();
}

function despliegaMenu(){

	productores=[];

	for(entry in _MENU){
		originalname=entry;
		nomnew=entry.split("(");
		redes="-";
		nomproductor=nomnew[0].trim();
		nomproductor.replace('"','');

		productores.push(nomproductor);
		// if(nomnew[1]){
		// 	redes=nomnew[1].replace(")","");
		// 	nomproductor='<a href="'+'https://www.instagram.com/'+nomproductor.replace("@","")+'" target="_blank">'+nomproductor+'</a>'
		// }
		buttons='';

		
	    for(i=0;i<_MENU[entry].length;i++){
	    	min=0;
	    	d_=_MENU[entry][i];
	    	nomproducto=d_[0].replace("[[[[[[[[[[[AGOTADO]]]]]]]]]]","(AGOTADO)").trim();
	    	_productos[d_[9]]=[d_[0]+"[|]"+originalname,0,d_[7]]
	    	//Procesa instagram
	    	linkSocial=d_[5];
	    	if(d_[5].includes("@")){
	    		f1=d_[5].split("@");
	    		linkSocial=f1[0].replace("(","")+'<a target="_blank" href="https://www.instagram.com/'
	    					+f1[1].replace(")","") 
	    					+ '">@'+f1[1].replace(")","")+'</a>';
	    		
	    	}
	    	//procesa fraccionados
	    	if(d_[1].includes("/")){
	    		console.log(d_[1],"--")
	    		if(d_[1].includes("1/2")){min=".5"}
	    		if(d_[1].includes("1/4")){min=".25"}
	    		trstr='<tr class="prow unselected" id="'+d_[9]+'">\
		      <td>'+linkSocial+'</td>\
		      <td style="background-color:#ffffff;">'+nomproducto+'</td>\
		      <td>'+d_[3]+'</td>\
		      <td>'+d_[1]+'</td>\
		      <td>'+d_[7]+'</td>'+
		      '<td style="min-width:200px;background-color:#ffffff;"><div class="inc button-m">+</div><input value="0" type="number" max="'+d_[3]+'" id="tentacles" idrow="'+d_[9]+'" onchange="updateInput(this.value,'+d_[9]+')" class="prInput inputsmall" producer="" product="'+d_[0]+'" name="tentacles"min="0" step="'+min+'" ><div class="plu button-p">-</div></td>'+
		      '<td class="totalind">0</td>'+
		    '</tr>'
	    	}
	    	else{
	    		trstr='<tr class="prow unselected" id="'+d_[9]+'">\
		      <td>'+linkSocial+'</td>\
		      <td style="background-color:#ffffff;">'+nomproducto+'</td>\
		      <td>'+d_[3]+'</td>\
		      <td>'+d_[1]+'</td>\
		      <td>'+d_[7]+'</td>'+
		      '<td style="min-width:200px;background-color:#ffffff;"><div class="inc button-m">+</div><input value="0"  type="number" max="'+d_[3]+'" id="tentacles" idrow="'+d_[9]+'" onchange="updateInput(this.value,'+d_[9]+')" class=" inputsmall" producer="" step="1" product="'+d_[0]+'" name="tentacles"min="0" disabled><div class="plu button-p">-</div></td>'+
		      '<td class="totalind">0</td>'+
		    '</tr>'
	    	}
	    	
	    	$("#tabla_productos").append(trstr)
	    }

	}
	initB();
	    
}
function initB(){

	$(".button-p").on("click", function() {
		step=Number.parseFloat ( $(this).parent().find("input").attr("step") );
		actual=Number.parseFloat ( $(this).parent().find("input").val() );
		max=Number.parseFloat ( $(this).parent().find("input").attr("max") );
		idrow= $(this).parent().find("input").attr("idrow") ;
		if(actual+step <= max){
			$(this).parent().find("input").val(actual+step);
			updateInput($(this).parent().find("input").val(), idrow);
		}
		
		//makesum();
		console.log("plus",step)
	});
	$(".button-m").on("click", function() {
		step=Number.parseFloat ( $(this).parent().find("input").attr("step") );
		actual=Number.parseFloat ( $(this).parent().find("input").val() );
		idrow= $(this).parent().find("input").attr("idrow") ;
		if(actual-step >= 0){
			$(this).parent().find("input").val(actual-step);
			updateInput($(this).parent().find("input").val(), idrow);
		}
		
		//makesum();
	});


}


function togglecar(){
	if(carselected){
		$(".carrito").css("background-color","grey")
		$(".unselected").toggle();
		carselected=false;
	}
	else{
		$(".carrito").css("background-color","cornflowerblue")
		$(".unselected").toggle();
		carselected=true;
	}
}
function updateInput(ish, idrow){
	_productos[idrow][1]=ish;
	precio=Number.parseFloat( _productos[idrow][2].replace("$","") );
	if(ish==0){
		$("tr#"+idrow).css("background-color","white")
		$("tr#"+idrow).addClass( "unselected" );
		$("tr#"+idrow).find("td.totalind").html(0)
	}
	else{
		$("tr#"+idrow).css("background-color","skyblue")
		$("tr#"+idrow).removeClass( "unselected" );
		totalind=Number.parseFloat(ish)*precio;
		$("tr#"+idrow).find("td.totalind").html(totalind)
	}
	//console.log(_productos)
	makesum()
	//console.log(_productos)
}
function makesum(){
	num=0;
	sum=0;
	envio=parseFloat( $("#costoenv").html() );//Number.parseFloat($('input:radio[name=zona]:checked').val() );
	sum+=envio;
	$("#compras0").html("");
	$("#compras1").html("");
	$("#compras2").html("");
	for (id in _productos){
		rem=num%3;
		item=_productos[id];
		precio=Number.parseFloat(item[2].replace("$","") );
		cantidad=Number.parseFloat(item[1] );
		sum+=precio*cantidad;
		if (cantidad>0) {
			carro=item[0]+" - "+cantidad+" - "+(precio*cantidad);
			//$("#compras"+rem).append(carro);
			num+=1;
		}
		
	}
	console.log("sum",sum,envio)
	$("#sum").text(sum);
}
function checkout(){
		form_name=_USER.username;
		form_telefono=_USER.phone;
		form_direccion=_USER.calle+" "
		+_USER.noint+"- "
		+_USER.noext+", "
		+_USER.colonia+", "+_USER.delegacion;
		//form_comentario=$("#t_").val();
		if(form_name=="" || form_telefono=="" || form_direccion=="" ){
			alert("Favor de completar el registro");
		}
		else{
		form_total=$("#sum").html();
		envio=parseFloat( $("#costoenv").html() );
		orden={"usuario":_USER.username,"envio":envio,"zona":_ZONA,"usuario_id":_USER.id,"orden":_productos}
		$("#confirmainfo").text(form_name+" | "+form_direccion+" | "+form_telefono);
		$("#confirmatotal").text("$"+form_total+"  Pesos");
		$("#table_cont").hide();
		$(".splash").show();
		$(".searcharea").hide();

		}
		
}
function regresar(){
		
		$("#table_cont").show();
		$(".splash").hide();
		$(".searcharea").show();
}
function ordenar(){
		$(".ordenar").hide();
		orden={};
		form_name=_USER.username;
		form_telefono=_USER.phone;
		form_direccion=_USER.calle+" "
		+_USER.noint+"- "
		+_USER.noext+", "
		+_USER.colonia+", "+_USER.delegacion;
		indicaciones=_USER.indicaciones;
		form_total=$("#sum").html();
		envio=Number.parseFloat($("#costoenv").html() );
		orden={"total":form_total,"envio":envio,"username":_USER.username,"envio":envio,"zona":_ZONA,"usuario_id":_USER.id,"direccion":form_direccion,"indicaciones":indicaciones,"phone":_USER.phone,"email":_USER.email,"orden":_productos}
		//console.log("_productos",JSON.stringify(orden));
	        //var data = _productos;
	        $.ajax({
        url: '/orden',
        type: 'POST',
        contentType: 'application/json',
        data: JSON.stringify(orden),
        dataType: 'json',
        success: function (data){
			console.log("DATA",data);
			$("#avisofinal").html('<p>Tu pedido ha sido procesado! Para confirmar tu orden te pedimos enviar tu comprobante de pago y tu número de orden por whatsapp al teléfono: xxxxxx.</p> <p>Si deseas visualizar tu pedido, copia tu número de orden e ingresalo en el siguiente link: <a href="/orden" target="_blank">VISOR</a></p>');
			$("#numorden").text("Número de orden: "+data.orden);
			$(".regresar").hide();
			// $("#search1").html('<h1>numero de orden: '+data.orden+'</h1>')
			// $("#search2").html('')
			// $("#search3").html('Tu pedido ha sido procesado! Para confirmar tu orden te pedimos enviar tu comprobante de pago y tu número de orden por whatsapp al teléfono: 5572117094')
		}
    });

}
function setCookie(cname, cvalue, exdays) {
  var d = new Date();
  d.setTime(d.getTime() + (exdays*24*60*60*1000));
  var expires = "expires="+ d.toUTCString();
  document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
}
function dosignin(){
  jwt=getCookie("jwt");

  if(jwt.length>=2){
    checkInfo();
  }
  else{
    console.log("sign in");
  }
  _u=$("#_u").val();
  _p=$("#_p").val();
  console.log("log",_u,_p)
  $.ajax({
        url: '/api/auth/signin',
        type: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({"username":_u,"password":_p}),
        beforeSend: function (xhr) {   //Include the bearer token in header
        xhr.setRequestHeader("Authorization", 'Bearer '+ jwt);
        },
        dataType: 'json',
        success: function (data){
        	if(data.username){
        		_USER=data;
        		$("#infousuario").show();
          		$("#loginform").hide();
          		$("#nuevoreg").hide();
          		for (key in data) {
          			$("#t_"+key).html(data[key]);
	          	}
	         checkcp(data["cp"]);
          }
          setCookie("orionuser",data.username,70);
          setCookie("jwt",data.accessToken,70);
          console.log("DATA",data);
          
        }
    });
}
function checkInfo(){
	jwt=getCookie("jwt");
	username=getCookie("orionuser");
	$.ajax({
        url: '/api/touch/user',
        type: 'GET',
        contentType: 'application/json',
        headers: {"x-access-token":jwt,
        		  "orionuser":username
    	},
        dataType: 'json',
        success: function (data){
          console.log("DATA user",data);
          $("#userinfo").html();
          if(data.username.length>=1){
          	$("#infousuario").show();
          	$("#loginform").hide();
          	$("#nuevoreg").hide();
          	_USER=data;
          	for (key in data) {
          		$("#t_"+key).html(data[key]);
	          	// $("#userinfo").append('<div id="t_'+key+'">'+key+'</div><div>'+data[key]+'</div>');
	          }
	        checkcp(data["cp"]);
          }
          
          
        }
    });
	console.log("already signed");
}
function getCookie(cname) {
  var name = cname + "=";
  var decodedCookie = decodeURIComponent(document.cookie);
  var ca = decodedCookie.split(';');
  for(var i = 0; i <ca.length; i++) {
    var c = ca[i];
    while (c.charAt(0) == ' ') {
      c = c.substring(1);
    }
    if (c.indexOf(name) == 0) {
      return c.substring(name.length, c.length);
    }
  }
  return "";
}
</script>
	
</script>
</html>